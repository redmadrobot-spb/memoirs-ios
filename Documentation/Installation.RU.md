# Установка библиотеки Робологов (Robologs)

## Подключение

Библиотека подключается в виде фреймворка `Robologs.framework`. Если хочется, можно подключить исходниками, тогда сами.

При подключении можно использовать только `Robologs.framework`. Но если нужно отправлять логи на сервер, то нужно подключить ещё и `swift-protobuf.framework`.
Пожалуйста, смотрите на то, что подключилось, чтобы не подключать лишнего. Собирается/подключается она автоматически, но в проект все-равно добавляется руками.

Подключить проще всего через SPM, можно использовать Carthage. CocoaPods не поддерживаются (и пока не планируют поддерживаться).

Стабильная ветка — `master`, если нужны последние фичи, можно подключить `dev`, там обычно тоже все более-менее стабильно.

#### Swift Package Manager (предпочтительно)

- Добавить в проект репозиторий `https://git.redmadrobot.com/RedMadRobot/SPb/Robologs/sdk-apple`.
- Добавить фреймворки (protobuf по необходимости) в проект.

#### Carthage (тут могут быть проблемы)

- Добавить в Cartfile `git "https://git.redmadrobot.com/RedMadRobot/SPb/Robologs/sdk-apple"` и обновить зависимости.
- Добавить фреймворки (protobuf по необходимости) в проект.
- Добавлять Robologs.framework в `copy-frameworks` step не нужно, так как он собирается, как статический фреймворк.

## Использование (Swift)

Обычно для использования нужно сконфигурировать логгер, потом положить его либо в DI, либо куда-нибудь в синглтон, и пользоваться им из всего приложения.
Почти все логгеры можно комбинировать друг с другом, чтобы было веселее. Ну и пользы немножко есть.

#### 0. Подключим Robologs в файл

```swift
import Robologs
```

#### 1. Создадим логгер, например, простой, PrintLogger:

```swift
// первый параметр позволит не писать дату, что увеличивает доступное для лога место.
// Второй — с той же целью сокращает строку «откуда вызван лог».
let logger = PrintLogger(onlyTime: true, shortSource: true)
```

#### 2. Выведем в лог что-нибудь полезное:

```swift
logger.log(level: .debug, "Hello Robologs!", label: "Test Label", meta: [ "tag": "first test" ])
```

Что значит каждый параметр?
 - level. Уровень, приоритет, серьёзность лога. Про уровни — в отдельном разделе.
 - message (неименованный). То, что нужно вывести в лог. Все параметры, которые выводятся в лог, по-умолчанию считаются "приватными" (про это отдельный раздел) 
   и будут выводиться в `PrintLogger` (или в дебаг-режиме в другие логгеры), но цензурироваться в других ситуациях.
 - label. Метка лога для удобной фильтрации логов при просмотре. Например, метка `"Network"` для сетевых логов, `"ui"` для логов уровня представления, 
   `"sql"` для логов из СУБД. Часто удобно метки расставлять по названию типа, который логи выдаёт. Для этого есть `LabeledLogger`.
 - meta. Дополнительная метаинформация. TODO: Пока не понятно до конца, как правильно её использовать.
 - (невидимые) file, function, line — подставят источник лога, чтобы можно было узнать, где случилось то, что случилось.

Можно также воспользоваться одним из сокращений (они называются по уровням логов). Для нашего примера подойдёт такой:

```swift
logger.debug("Hello Robologs!", label: "Test Label", meta: [ "tag": "first test" ])
``` 

#### 3. LabeledLogger

Чтобы не писать в каждом логе `label: "..."`, можно воспользоваться `LabeledLogger`'ом. Он подставит `label`, указанный при инициализации, во все логи, которые проходят через него. Можоно создать логгер с объектом, тогда `label` будет взят из его названия:

```swift
let logger = LabeledLogger(object: self, logger: logger)
logger.debug("Hello Robologs!") // meta тоже необязательна
```

#### 4. FilteringLogger

Иногда хочется иметь возможность включить/выключить логи, начиная с какого-то уровня (например, смотреть только логи `.info` и "более важные" до `.critical`).

Ещё более интересная возможность — фильтровать логи по лейблам. Это позволяет сосредоточиться на конкретной проблеме, не обращая внимание на всё остальное. Для этого есть `FilteringLogger`.

```swift
let logger = FilteringLogger(
    logger: PrintLogger(onlyTime: true),
    loggingLevelForLabels: [
        "Network": .debug, // сейчас отлаживаем сетевые логи
        "UI": .warning, // UI — только если что-то ломается
    ],
    defaultLevel: .info // по-умолчанию показываем "обычные логи"
)
```

#### 5. MultiplexingLogger

Чтобы перенаправить вывод логов в несколько логгеров, можно пользоваться `MultiplexingLogger`. TODO: А тут нужно что-то ещё?

#### 6. RemoteLogger

Самый сложный логгер — для того, чтобы отправлять логи на сервер, и через сервер как смотреть на логи в реальном времени (в браузере, или специальном приложении), так и постфактум (если логи сохранялись на сервер).

TODO: Тут нужно аккуратно про всё написать.

## Вывод данных в логи, цензурирование логов

Чтобы вывести что-то в лог (или записать в мету), можно написать так: `"Something"`. Если хочется вывести какой-то объект (даже если объект — строка), его нужно выводить так: `"\(something)"`. 
Все объекты в процессе интерполяции цензурируются. По-умолчанию всё будет вырезано (заменено на `<private>`). 
Это не видно в `PrintLogger'е` (так как никуда оно из консоли не убежит), чтобы это увидеть, попробуйте `NSLogLogger`.
При его инициализации нужно передать параметр `isSensitive`. `true` будет обозначать, что ценные данные будут вырезаны, `false` — что ценные данные покажутся. Обычно это разница между DEBUG и RELEASE сборками.

Чтобы управлять этим поведением, можно использовать специальное имя параметра в интерполяции. Объект, выводящийся так `"\(safe: something)"`, будет показан даже, если `isSensitive == true`
Если таким образом вывести объект, он целиком либо заменится на `<private>`, либо выведется. Чтобы вывести только часть полей, а часть — зацензурировать, нужно 
 - прописать, что объект реализовывает маркерный протокол `Loggable`
 - у полей, которые безопасно выводить, прописать аннотацию `@SafeToLog`. У полей, которые должны цензурироваться, если `isSensitive == true`, можно прописать `@Sensitive`. Если есть поля, которые не должны выводиться даже в случае, если `isSensitive == false`, им можно указать `@NeverLog` и они будут цензурироваться всегда.

## Уровни, приоритеты логов

#### Verbose

TODO: Описать

#### Debug

TODO: Описать

#### Info

TODO: Описать

#### Warning

TODO: Описать

#### Error

TODO: Описать

#### Critical

TODO: Описать

## Поддерживаемые платформы

- iOS (9.0 и выше)
- macOS (10.15 и выше)
